<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition 
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.org/ui"
    xmlns:f="http://java.sun.com/jsf/core"   
    xmlns:h="http://java.sun.com/jsf/html">              

    <ui:remove> -------------------------- Artifacts ------------------- </ui:remove>
    <h:form id="artifactForm" prependId="false" >
        <p:panel toggleable="true"  >
            <f:facet name="header">                           
                <h:outputText value="Artifact : " />
                <p:commandButton  icon="ui-icon-plus"   value="Link" update="afTable :messages" 
                                  process="@this" actionListener="#{componentTypeMananger.onArtifactAdd}" 
                                  oncomplete="PF('artLinkDlg').show()"/>
                <p:commandButton  icon="ui-icon-plus"   value="File" update="afTable :messages" 
                                  process="@this" actionListener="#{componentTypeMananger.onArtifactAdd}" 
                                  oncomplete="PF('artFileDlg').show()"/>
            </f:facet>
            <p:dataTable id="afTable" var="art" value="#{componentTypeMananger.selectedArtifacts}" 
                         scrollRows="25" scrollable="true" liveScroll="true"   scrollHeight="200"                               
                         emptyMessage="No artifacts found"  editMode="row" editable="false" 
                         rowKey="#{art.artifactId}}"  >                

                <p:ajax event="rowEdit" listener="#{componentTypeMananger.onArtifactSave}" update="afTable  :messages" />                  
                <p:ajax event="rowEditInit" listener="#{componentTypeMananger.onArtifactEdit}" update=":messages" />                  
                <p:ajax event="rowEditCancel" listener="#{componentTypeMananger.onArtifactCancel}" update="afTable  :messages" />                  

                <p:column id="ops" width="10%">
                    <p:commandLink  styleClass="ui-icon ui-icon-trash"  update="afTable  :messages" 
                                    process="@this" action="#{componentTypeMananger.onArtifactDelete(art)}" />
                </p:column>
                <p:column id="artName" headerText="Name">                    
                    <h:outputLink value="#{art.uri}"  target="_blank">
                        <h:outputText value="#{art.name}" />
                    </h:outputLink>                   
                </p:column>               
                <p:column id="desc" headerText="Description">
                    <h:outputText value="#{art.description}" />
                </p:column>  
                <p:column  headerText="D">                                        
                    <p:commandLink id="downloadLink" value="dl" ajax="false"                                  
                                     styleClass="ui-icon ui-icon-arrowthickstop-1-s" 
                                     actionListener="#{componentTypeMananger.downloadFile}" >   
                        <f:setPropertyActionListener target="#{componentTypeMananger.downloadFileName}" value="#{art.uri}" />
                        <p:fileDownload value="#{componentTypeMananger.downloadedFile}" />  
                    </p:commandLink>
                </p:column>
            </p:dataTable>
            
        </p:panel>
    </h:form>

    <ui:remove> -------------------------- Add File ------------------- </ui:remove>
    <p:dialog header="Attach a File" widgetVar="artFileDlg">
        <h:form id="artifactFileForm" prependId="false" enctype="multipart/form-data">
            <p:panelGrid id="artFilePanel" >
                <p:row>
                    <p:column><h:outputLabel value="Name:" /></p:column>
                    <p:column><h:inputText id="artfName" value="#{componentTypeMananger.inputArtifact.name}" 
                                           required="true"  /> 
                    </p:column>

                </p:row>
                <p:row>                       
                    <p:column><h:outputLabel value="Description:" /></p:column>
                    <p:column><p:inputTextarea id="artfDesc" value="#{componentTypeMananger.inputArtifact.description}" 
                                               required="true"   rows="5" cols="50"  /> </p:column>                   
                </p:row>
                <p:row>                
                    <p:column  colspan="2">
                        <h:outputText id="upFileName" value="Uploaded File: #{componentTypeMananger.uploadedFileName}" />
                        <p:fileUpload fileUploadListener="#{componentTypeMananger.handleFileUpload}"
                                      mode="advanced"  process="@this" 
                                      dragDropSupport="true" update="upFileName :messages"  required="true"/>                        
                    </p:column>                  
                </p:row>

                <p:row>
                    <p:column colspan="2">
                        <p:toolbar>
                            <p:toolbarGroup  align="right" >                      
                                <p:commandButton value="Save" icon="ui-icon-disk" 
                                                 update=":artifactForm :messages"
                                                 process="@this artFilePanel" actionListener="#{componentTypeMananger.onArtifactCreate}"
                                                 oncomplete="PF('artFileDlg').hide()" /> 
                                <p:separator /> 
                                <p:commandButton value="Cancel" icon="ui-icon-close"                                         
                                                 process="@this"  onclick="PF('artFileDlg').hide()" />
                            </p:toolbarGroup>
                        </p:toolbar>
                    </p:column>
                </p:row>
            </p:panelGrid>
        </h:form>
    </p:dialog>

    <ui:remove> -------------------------- Add Link ------------------- </ui:remove>
    <p:dialog header="Attach a Link" widgetVar="artLinkDlg">
        <h:form id="artifactLinkForm" prependId="false" >
            <p:panelGrid id="artAddPanel" >
                <p:row>
                    <p:column><h:outputLabel value="Name :" /></p:column>
                    <p:column><h:inputText id="artName" value="#{componentTypeMananger.inputArtifact.name}" 
                                           required="true"  /> 
                    </p:column>
                    <p:watermark for="artName" value="Enter a name for artifact"/>
                </p:row>
                <p:row>                       
                    <p:column><h:outputLabel value="Description :" /></p:column>
                    <p:column><p:inputTextarea id="artDesc" value="#{componentTypeMananger.inputArtifact.description}" 
                                               required="true"   rows="5" cols="50"  /> </p:column>
                    <p:watermark for="artDesc" value="Enter artifact's description"/>
                </p:row>
                <p:row>
                    <p:column><h:outputLabel value="URI :" /></p:column>
                    <p:column><h:inputText id="artURI" value="#{componentTypeMananger.inputArtifact.uri}" 
                                           required="true"  />
                    </p:column>
                    <p:watermark for="artURI" value="Enter artifact's URI"/>
                </p:row>
            </p:panelGrid>
            <p:toolbar>
                <p:toolbarGroup  align="right" >                      
                    <p:commandButton value="Save" icon="ui-icon-disk" 
                                     update=":artifactForm :messages" 
                                     process="@form" actionListener="#{componentTypeMananger.onArtifactCreate}"
                                     oncomplete="PF('artLinkDlg').hide()" /> 
                    <p:separator /> 
                    <p:commandButton value="Cancel" icon="ui-icon-close"                                         
                                     process="@this"  onclick="PF('artLinkDlg').hide()" />
                </p:toolbarGroup>
            </p:toolbar> 
        </h:form>
    </p:dialog>
</ui:composition>
