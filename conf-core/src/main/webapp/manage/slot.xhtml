<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition 
    xmlns:ui="http://java.sun.com/jsf/facelets"
    template="/template/ConfigManagerTemplate.xhtml"
    xmlns:p="http://primefaces.org/ui"
    xmlns:f="http://java.sun.com/jsf/core"   
    xmlns:h="http://java.sun.com/jsf/html">              

    <ui:define name="content">

        <h:form id="propsform">
            <p:growl id="messages" showDetail="true"/>
            <p:contextMenu for="searchTable">  
                <p:menuitem value="Add" icon="ui-icon-plus"  update="managePanel messages" 
                            process="@this" actionListener="#{layoutSlotManager.onAdd}"
                            disabled="true"/>  
                <p:menuitem value="Edit" icon="ui-icon-pencil" update="managePanel messages" 
                            process="@this" actionListener="#{layoutSlotManager.onEdit}"
                            disabled="#{layoutSlotManager.inTrans}"/>  
                <p:menuitem value="Delete" icon="ui-icon-trash"  
                            onclick="PF('deleteConfirm').show()"
                            disabled="#{layoutSlotManager.inTrans}"/>  
            </p:contextMenu>  

            <ui:remove> -------------------------- Search  ------------------- </ui:remove>    
            <p:panel id="searchPanel" header="Search Layout Slots">
                <p:dataTable id="searchTable" var="obj" value="#{layoutSlotManager.objects}" 
                             scrollRows="25" scrollable="true" liveScroll="true"   scrollHeight="200"                  
                             selectionMode="single" selection="#{layoutSlotManager.selectedObject}"
                             filteredValue="#{layoutSlotManager.filteredObjects}"                             
                             emptyMessage="No records found!" 
                             rowKey="#{obj.logicalComponentId}}" >

                    <p:ajax event="rowSelect" listener="#{layoutSlotManager.onRowSelect}" update=":propsform:managePanel :propsform:messages" />

                    <p:column id="id" headerText="Name" sortBy="name" filterBy="name">
                        <h:outputText value="#{obj.name}"/>
                    </p:column>
                    <p:column id="desc" headerText="Description" filterBy="#{obj.description}" filterMatchMode="contains">
                        <h:outputText value="#{obj.description}"/>
                    </p:column>
                    <p:column id="blp" headerText="Position" sortBy="beamlinePosition" >
                        <h:outputText value="#{obj.beamlinePosition}"/>
                    </p:column>

                    <p:column id="moddate" headerText="Date Modified" rendered="false" >
                        <h:outputText value="#{obj.modifiedAt}">
                            <f:convertDateTime pattern="#{msgs.dateFormat}" />
                        </h:outputText>
                    </p:column>
                    <p:column id="modby" headerText="Modified By"  rendered="false">
                        <h:outputText value="#{obj.modifiedBy}" />                      
                    </p:column>

                </p:dataTable>
            </p:panel>

            <ui:remove> -------------------------- Manage  ------------------- </ui:remove>
            <p:focus context="managePanel"/>
            <p:panel id="managePanel" header="Manage Layout Slot" toggleable="true">
                <p:panelGrid columns="3" styleClass="noBorders">
                    <p:panel header="Layout Slot" toggleable="true">
                        <p:toolbar id="toolbar">
                            <p:toolbarGroup align="left" >  
                                <p:commandButton value="Add" icon="ui-icon-plus"  update="managePanel messages" 
                                                 process="@this" actionListener="#{componentTypeMananger.onAdd}"
                                                 disabled="#{componentTypeMananger.inTrans}"/>
                                <p:commandButton value="Edit" icon="ui-icon-pencil" update="managePanel messages" 
                                                 process="@this" actionListener="#{componentTypeMananger.onEdit}"
                                                 disabled="#{componentTypeMananger.inTrans || componentTypeMananger.selectedObject eq null}"/>

                                <p:commandButton value="View" icon="ui-icon-search" 
                                                 update=":viewForm:managePanel"
                                                 oncomplete="PF('viewPanel').show()"  rendered="false"/>
                                <p:commandButton value="Delete" icon="ui-icon-trash"  
                                                 onclick="PF('deleteConfirm').show()"
                                                 disabled="#{componentTypeMananger.inTrans || componentTypeMananger.selectedObject eq null}"/>
                                <p:separator /> 
                            </p:toolbarGroup>

                        </p:toolbar>   

                        <ui:remove> -------------------------- Delete Confirm ------------------- </ui:remove>
                        <p:dialog id="deleteConfirm"  widgetVar="deleteConfirm">  
                            <f:facet name="header">  
                                <h:outputText value="Delete Property"/> 
                            </f:facet>

                            <h:outputLabel value="Do you really want to delete this record?" />

                            <p:separator /> 
                            <p:commandButton value="Yes" style="float: left"  
                                             icon="ui-icon-check"
                                             process="@this managePanel" update="searchTable managePanel messages"
                                             oncomplete="PF('deleteConfirm').hide()"                                                                
                                             actionListener="#{componentTypeMananger.onDelete}"/> 
                            <p:commandButton  type="cancel" value="No" style="float: right"
                                              icon="ui-icon-close"
                                              update="managePanel messages" process="@this"                                  
                                              onclick="PF('deleteConfirm').hide()"  />  
                        </p:dialog>

                        <ui:remove> -------------------------- Input Form  ------------------- </ui:remove> 

                        <p:panelGrid id="inputForm" >
                            <p:row>
                                <p:column><h:outputLabel value="Slot Name:" /></p:column>
                                <p:column><h:inputText id="icode" value="#{layoutSlotManager.inputObject.name}" 
                                                       required="true"  readonly="#{! layoutSlotManager.inTrans}"/> 
                                </p:column>
                            </p:row>
                            <p:row>                       
                                <p:column><h:outputLabel value="Description:" /></p:column>
                                <p:column><p:inputTextarea id="idesc" value="#{layoutSlotManager.inputObject.description}" 
                                                           required="true" readonly="#{! layoutSlotManager.inTrans}"   rows="5" cols="50"  /> 
                                    <h:outputLabel value="Position: " /> </p:column>
                            </p:row>
                            <p:row>
                                <p:column><h:outputLabel value="Position: " /></p:column>
                                <p:column><p:inputText id="iblp" value="#{layoutSlotManager.inputObject.beamlinePosition}" 
                                                       required="true" readonly="#{! layoutSlotManager.inTrans}"   />
                                </p:column>
                            </p:row>
                        </p:panelGrid>
                        <p:toolbar>
                            <p:toolbarGroup  align="right" >  
                                <p:separator /> 
                                <p:commandButton value="Save" icon="ui-icon-disk" 
                                                 update="searchTable managePanel messages" 
                                                 process="@this managePanel" actionListener="#{componentTypeMananger.onSave}"
                                                 disabled="#{! componentTypeMananger.inTrans}"/>  
                                <p:commandButton value="Cancel" icon="ui-icon-close" 
                                                 update="managePanel messages" 
                                                 process="@this" actionListener="#{componentTypeMananger.onCancel}"
                                                 disabled="#{! componentTypeMananger.inTrans}"/>
                            </p:toolbarGroup>
                        </p:toolbar> 
                    </p:panel>
                    <ui:remove> -------------------------- Properties ------------------- </ui:remove>
                    <p:panel toggleable="true" visible="#{componentTypeMananger.selectedObject ne null}">
                        <f:facet name="header">
                            Properties:
                            <p:commandButton  icon="ui-icon-plus"  update="propertyTable :propsform:messages" 
                                              process="@this" actionListener="#{componentTypeMananger.onPropertyAdd}" />
                        </f:facet>
                        <p:contextMenu for=":propsform:propertyTable" widgetVar="propMenu">  
                            <p:menuitem value="Delete Property" icon="ui-icon-trash"  update=":propsform:propertyTable  :propsform:messages" 
                                        actionListener="#{componentTypeMananger.onPropertyDelete}"
                                        />  
                            <p:menuitem value="Hide Menu" icon="ui-icon-close"  onclick="PF('propMenu').hide()"/>                  
                        </p:contextMenu>

                        <p:dataTable id="propertyTable" var="ctp" value="#{componentTypeMananger.selectedCompProps}" 
                                     scrollRows="25" scrollable="true" liveScroll="true"   scrollHeight="200"                               
                                     emptyMessage="No properties."  editMode="cell" editable="true" 
                                     rowKey="#{ctp.componentTypePropertyPK}}"  >                

                            <p:ajax event="cellEdit" listener="#{componentTypeMananger.onPropertyEdit}" update=":propsform:propertyTable  :propsform:messages" />                  

                            <p:column id="id" headerText="Name" sortBy="#{ctp.componentTypePropertyPK.property}">
                                <p:cellEditor>
                                    <f:facet name="output"><h:outputText value="#{ctp.componentTypePropertyPK.property}" /></f:facet>
                                    <f:facet name="input">
                                        <h:selectOneMenu value="#{ctp.componentTypePropertyPK.property}" style="width:100%">
                                            <f:selectItem itemLabel="Select One" itemValue="" />
                                            <f:selectItems value="#{propertyManager.objects}" var="prop" itemLabel="#{prop.propertyId}" itemValue="#{prop.propertyId}" />
                                        </h:selectOneMenu>
                                    </f:facet>
                                </p:cellEditor>
                            </p:column>
                            <p:column id="desc" headerText="Description" rendered="false">
                                <h:outputText value="#{ctp.property1.description}"/>
                            </p:column>
                            <p:column id="units" headerText="Unit" rendered="false">
                                <h:outputText value="#{ctp.property1.unit.unitId}" />
                            </p:column>
                            <p:column id="value" headerText="Value">
                                <p:cellEditor>
                                    <f:facet name="output"><h:outputText value="#{ctp.value}" /></f:facet>
                                    <f:facet name="input"><p:inputText id="invalue" value="#{ctp.value}" style="width:96%"/></f:facet>
                                    <p:watermark for="invalue" value="Enter value of property"/>
                                </p:cellEditor> 
                                <p:watermark for="invalue" value="Enter value of property"/>
                            </p:column>
                            <p:column id="ops" width="15%">
                                <p:commandLink  styleClass="ui-icon ui-icon-trash"  update=":propsform:propertyTable  :propsform:messages" 
                                                action="#{componentTypeMananger.onPropertyDelete(ctp)}" />
                            </p:column>
                        </p:dataTable>
                    </p:panel>

                    <ui:remove> -------------------------- Artifacts ------------------- </ui:remove>
                    <p:panel header="Artifacts" toggleable="true"  visible="#{componentTypeMananger.selectedObject ne null}">
                        <p:dataTable id="afTable" var="ctp" value="#{componentTypeMananger.selectedArtifacts}" 
                                     scrollRows="25" scrollable="true" liveScroll="true"   scrollHeight="200"                               
                                     emptyMessage="No artifacts found"  editMode="cell" editable="true" 
                                     rowKey="#{ctp.componentTypePropertyPK}}"  >                

                            <p:ajax event="cellEdit" listener="#{componentTypeMananger.onPropertyEdit}" update=":propsform:propertyTable  :propsform:messages" />                  

                            <p:column id="id" headerText="Description" >
                                <p:cellEditor>
                                    <f:facet name="output"><h:outputText value="#{ctp.componentTypePropertyPK.property}" /></f:facet>
                                    <f:facet name="input">
                                        <h:selectOneMenu value="#{ctp.componentTypePropertyPK.property}" >
                                            <f:selectItem itemLabel="Select One" itemValue="" />
                                            <f:selectItems value="#{propertyManager.objects}" var="prop" itemLabel="#{prop.propertyId}" itemValue="#{prop.propertyId}" />
                                        </h:selectOneMenu>
                                    </f:facet>
                                </p:cellEditor>
                            </p:column>                       
                            <p:column id="value" headerText="Link">
                                <p:cellEditor>
                                    <f:facet name="output"><h:outputText value="#{ctp.value}" /></f:facet>
                                    <f:facet name="input"><p:inputText id="invalue" value="#{ctp.value}" /></f:facet>
                                    <p:watermark for="invalue" value="Enter value of property"/>
                                </p:cellEditor> 
                                <p:watermark for="invalue" value="Enter value of property"/>
                            </p:column>
                            <p:column id="ops" width="15%">
                                <p:commandButton  icon="ui-icon-trash"  update=":propsform:propertyTable  :propsform:messages" 
                                                  action="#{componentTypeMananger.onPropertyDelete(ctp)}" />
                            </p:column>
                        </p:dataTable>
                    </p:panel>
                </p:panelGrid>
            </p:panel>
            </h:form>
    </ui:define>
</ui:composition>
